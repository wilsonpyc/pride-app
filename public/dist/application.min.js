"use strict";var ApplicationConfiguration=function(){var applicationModuleName="pride-app",applicationModuleVendorDependencies=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("articles"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("metrics"),ApplicationConfiguration.registerModule("users"),angular.module("articles").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Articles","articles","dropdown","/articles(/create)?"),Menus.addSubMenuItem("topbar","articles","List Articles","articles"),Menus.addSubMenuItem("topbar","articles","New Article","articles/create")}]),angular.module("articles").config(["$stateProvider",function($stateProvider){$stateProvider.state("listArticles",{url:"/articles",templateUrl:"modules/articles/views/list-articles.client.view.html"}).state("createArticle",{url:"/articles/create",templateUrl:"modules/articles/views/create-article.client.view.html"}).state("viewArticle",{url:"/articles/:articleId",templateUrl:"modules/articles/views/view-article.client.view.html"}).state("editArticle",{url:"/articles/:articleId/edit",templateUrl:"modules/articles/views/edit-article.client.view.html"})}]),angular.module("articles").controller("ArticlesController",["$scope","$stateParams","$location","Authentication","Articles",function($scope,$stateParams,$location,Authentication,Articles){$scope.authentication=Authentication,$scope.create=function(){var article=new Articles({title:this.title,content:this.content});article.$save(function(response){$location.path("articles/"+response._id),$scope.title="",$scope.content=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(article){if(article){article.$remove();for(var i in $scope.articles)$scope.articles[i]===article&&$scope.articles.splice(i,1)}else $scope.article.$remove(function(){$location.path("articles")})},$scope.update=function(){var article=$scope.article;article.$update(function(){$location.path("articles/"+article._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.articles=Articles.query()},$scope.findOne=function(){$scope.article=Articles.get({articleId:$stateParams.articleId})}}]),angular.module("articles").factory("Articles",["$resource",function($resource){return $resource("articles/:articleId",{articleId:"@_id"},{update:{method:"PUT"}})}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"})}]),angular.module("core").controller("HeaderController",["$scope","Authentication","Menus",function($scope,Authentication,Menus){$scope.authentication=Authentication,$scope.isCollapsed=!1,$scope.menu=Menus.getMenu("topbar"),$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1})}]),angular.module("core").controller("HomeController",["$scope","Authentication",function($scope,Authentication){$scope.authentication=Authentication}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var shouldRender=function(user){if(!user)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,isPublic,roles){return this.menus[menuId]={isPublic:isPublic||!1,roles:roles||this.defaultRoles,items:[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,menuItemTitle,menuItemURL,menuItemType,menuItemUIRoute,isPublic,roles,position){return this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:menuItemTitle,link:menuItemURL,menuItemType:menuItemType||"item",menuItemClass:menuItemType,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].roles:roles,position:position||0,items:[],shouldRender:shouldRender}),this.menus[menuId]},this.addSubMenuItem=function(menuId,rootMenuItemURL,menuItemTitle,menuItemURL,menuItemUIRoute,isPublic,roles,position){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===rootMenuItemURL&&this.menus[menuId].items[itemIndex].items.push({title:menuItemTitle,link:menuItemURL,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].items[itemIndex].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].items[itemIndex].roles:roles,position:position||0,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===menuItemURL&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].link===submenuItemURL&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar")}]),angular.module("metrics").config(["$stateProvider",function($stateProvider){$stateProvider.state("viewMetrics",{url:"/metrics",templateUrl:"modules/metrics/views/view-metrics.client.view.html"}).state("viewReports",{url:"/metrics/report",templateUrl:"modules/metrics/views/view-reports.client.view.html"})}]);var metricsApp=angular.module("metrics");metricsApp.controller("MetricsController",["$scope","$modal","$log","$http","$location",function($scope,$modal,$log,$http,$location){var loadAndRefresh=function(){$http.get("/metrics").success(function(response){$scope.metrics=response,$scope.metric="",console.log("Data Loaded/Refreshed")})};loadAndRefresh(),this.modalFilter=function(size){var modalInstance=$modal.open({templateUrl:"modules/metrics/views/filter-metrics.view.html",controller:"MetricsFilterController",size:size});modalInstance.result.then(function(filteredMetrics){$scope.metrics=filteredMetrics},function(){$log.info("Modal dismissed at: "+new Date)})},this.modalInsert=function(size){var modalInstance=$modal.open({templateUrl:"modules/metrics/views/insert-metrics.view.html",controller:["$scope","$modalInstance",function($scope,$modalInstance){$scope.addMetric=function(){console.log("1 record has been added."),$modalInstance.close(),loadAndRefresh()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}],size:size});modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)})},this.modalUpdate=function(size,id){var modalInstance=$modal.open({templateUrl:"modules/metrics/views/update-metrics.view.html",controller:["$scope","$modalInstance",function($scope,$modalInstance){var readRecord=function(){$http.get("/metrics/"+id).success(function(response){$scope.metric=response})};readRecord(),$scope.updateMetric=function(){$http.put("/metrics/"+$scope.metric._id,$scope.metric).success(function(response){console.log(response),console.log("Record has been updated.")}),$modalInstance.close(),loadAndRefresh()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}],size:size});modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)})},this["delete"]=function(id){console.log(id),$http["delete"]("/metrics/"+id).success(function(response){loadAndRefresh()})}}]),metricsApp.controller("MetricsFilterController",["$scope","$http","$modalInstance",function($scope,$http,$modalInstance){$scope.selected={},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.applyFilter=function(){$http.post("/metrics/query",$scope.selected).success(function(response){$modalInstance.close(response)})}}]),metricsApp.controller("MetricsCreateController",["$http",function($http){this.create=function(){var metric={ffc:this.ffc,factoryname:this.factoryname,coalition:this.coalition,supplychain:this.supplychain,brand:this.brand,year:this.year,month:this.month,metrics:{factory:{majorDefectsOql:{audited:this.factory_majorDefectsOql_audited,defects:this.factory_majorDefectsOql_defects},packagingOql:{audited:this.factory_packagingOql_audited,defects:this.factory_packagingOql_defects},fitOql:{audited:this.factory_fitOql_audited,defects:this.factory_fitOql_defects},majorDefectsSql:{audited:this.factory_majorDefectsSql_audited,defects:this.factory_majorDefectsSql_defects},firstPass:{audited:this.factory_firstPass_audited,passed:this.factory_firstPass_passed},processAudit:{score:this.factory_processAudit_score,date:this.factory_processAudit_date}},dc:{majorDefectsOql:{audited:this.dc_majorDefectsOql_audited,defects:this.dc_majorDefectsOql_defects},packagingOql:{audited:this.dc_packagingOql_audited,defects:this.dc_packagingOql_defects},fitOql:{audited:this.dc_fitOql_audited,defects:this.dc_fitOql_defects},customization:{audited:this.dc_customization_audited,defects:this.dc_customization_defects},rework:{total:this.dc_rework_total,vendorChargeback:this.dc_rework_vendorChargeback},internalChargebacks:this.dc_internalChargebacks,vasCompliance:this.dc_vasCompliance,warrantyClaims:this.dc_warrantyClaims,claims:{received:this.dc_claims_received,returned:this.dc_claims_returned},keyAccountsChargebacks:this.dc_keyAccountsChargebacks}}};$http.post("/metrics",metric).success(function(response){console.log(response)})}}]),metricsApp.controller("MetricsUpdateController",["$http","$scope",function($http,$scope){}]),metricsApp.controller("MetricsReportController",["$http","$scope","$q","$modal","$log",function($http,$scope,$q,$modal,$log){var s=function(selected){return $http.post("/report",selected)},c=function(selected){return $http.post("/report/count",selected)};$scope.dataset=[],$scope.selected={},$scope.getReport=function(selected){$q.all([s(selected),c(selected)]).then(function(datasets){var combineData=function(a,b){for(var aDataset=[],bDataset=[],i=0;i<a.length;i++){var aData={key:a[i].year+a[i].month+a[i].coalition+a[i].supplychain,year:a[i].year,month:a[i].month,coalition:a[i].coalition,supplychain:a[i].supplychain,majorDefectsOqlRate:{value:a[i].majorDefectsOqlRate},packagingOqlRate:{value:a[i].packagingOqlRate},fitOqlRate:{value:a[i].fitOqlRate},dcMajorDefectsOqlRate:{value:a[i].dcMajorDefectsOqlRate},dcPackagingOqlRate:{value:a[i].dcPackagingOqlRate},dcFitOqlRate:{value:a[i].dcFitOqlRate},majorDefectsSqlRate:{value:a[i].majorDefectsSqlRate},firstPassRate:{value:a[i].firstPassRate},processAuditScore:{value:a[i].processAuditScore},dcCustomizationRate:{value:a[i].dcCustomizationRate},dcClaimsRate:{value:a[i].dcClaimsRate},dcReworkTotal:{value:a[i].dcReworkTotal},dcInternalChargebacks:{value:a[i].dcInternalChargebacks},dcWarrantyClaims:{value:a[i].dcWarrantyClaims},dcVasCompliance:{value:a[i].dcVasCompliance},dcKeyAccountsChargebacks:{value:a[i].dcKeyAccountsChargebacks}};aDataset.push(aData),aData={}}for(i=0;i<b.length;i++){var bData={key:b[i].year+b[i].month+b[i].coalition+b[i].supplychain,majorDefectsOqlRate_countNotGood:b[i].majorDefectsOqlRate_countNotGood,packagingOqlRate_countNotGood:b[i].packagingOqlRate_countNotGood,fitOqlRate_countNotGood:b[i].fitOqlRate_countNotGood,dcMajorDefectsOqlRate_countNotGood:b[i].dcMajorDefectsOqlRate_countNotGood,dcPackagingOqlRate_countNotGood:b[i].dcPackagingOqlRate_countNotGood,dcFitOqlRate_countNotGood:b[i].dcFitOqlRate_countNotGood,majorDefectsSqlRate_countNotGood:b[i].majorDefectsSqlRate_countNotGood,firstPassRate_countNotGood:b[i].firstPassRate_countNotGood,processAuditScore_countNotGood:b[i].processAuditScore_countNotGood,dcCustomizationRate_countNotGood:b[i].dcCustomizationRate_countNotGood,dcClaimsRate_countNotGood:b[i].dcClaimsRate_countNotGood,dcReworkTotal_countNotGood:b[i].dcReworkTotal_countNotGood,dcInternalChargebacks_countNotGood:b[i].dcInternalChargebacks_countNotGood,dcWarrantyClaims_countNotGood:b[i].dcWarrantyClaims_countNotGood,dcVasCompliance_countNotGood:b[i].dcVasCompliance_countNotGood,dcKeyAccountsChargebacks_countNotGood:b[i].dcKeyAccountsChargebacks_countNotGood,majorDefectsOqlRate_countRisk:b[i].majorDefectsOqlRate_countRisk,packagingOqlRate_countRisk:b[i].packagingOqlRate_countRisk,fitOqlRate_countRisk:b[i].fitOqlRate_countRisk,dcMajorDefectsOqlRate_countRisk:b[i].dcMajorDefectsOqlRate_countRisk,dcPackagingOqlRate_countRisk:b[i].dcPackagingOqlRate_countRisk,dcFitOqlRate_countRisk:b[i].dcFitOqlRate_countRisk,majorDefectsSqlRate_countRisk:b[i].majorDefectsSqlRate_countRisk,firstPassRate_countRisk:b[i].firstPassRate_countRisk,processAuditScore_countRisk:b[i].processAuditScore_countRisk,dcCustomizationRate_countRisk:b[i].dcCustomizationRate_countRisk,dcClaimsRate_countRisk:b[i].dcClaimsRate_countRisk,dcReworkTotal_countRisk:b[i].dcReworkTotal_countRisk,dcInternalChargebacks_countRisk:b[i].dcInternalChargebacks_countRisk,dcWarrantyClaims_countRisk:b[i].dcWarrantyClaims_countRisk,dcVasCompliance_countRisk:b[i].dcVasCompliance_countRisk,dcKeyAccountsChargebacks_countRisk:b[i].dcKeyAccountsChargebacks_countRisk};bDataset.push(bData),bData={}}for(i=0;i<aDataset.length;i++)for(var k=0;k<bDataset.length;k++)aDataset[i].key===bDataset[k].key&&(aDataset[i].majorDefectsOqlRate.countNotGood=bDataset[k].majorDefectsOqlRate_countNotGood,aDataset[i].packagingOqlRate.countNotGood=bDataset[k].packagingOqlRate_countNotGood,aDataset[i].fitOqlRate.countNotGood=bDataset[k].fitOqlRate_countNotGood,aDataset[i].dcMajorDefectsOqlRate.countNotGood=bDataset[k].dcMajorDefectsOqlRate_countNotGood,aDataset[i].dcPackagingOqlRate.countNotGood=bDataset[k].dcPackagingOqlRate_countNotGood,aDataset[i].dcFitOqlRate.countNotGood=bDataset[k].dcFitOqlRate_countNotGood,aDataset[i].majorDefectsSqlRate.countNotGood=bDataset[k].majorDefectsSqlRate_countNotGood,aDataset[i].firstPassRate.countNotGood=bDataset[k].firstPassRate_countNotGood,aDataset[i].processAuditScore.countNotGood=bDataset[k].processAuditScore_countNotGood,aDataset[i].dcCustomizationRate.countNotGood=bDataset[k].dcCustomizationRate_countNotGood,aDataset[i].dcClaimsRate.countNotGood=bDataset[k].dcClaimsRate_countNotGood,aDataset[i].dcReworkTotal.countNotGood=bDataset[k].dcReworkTotal_countNotGood,aDataset[i].dcInternalChargebacks.countNotGood=bDataset[k].dcInternalChargebacks_countNotGood,aDataset[i].dcWarrantyClaims.countNotGood=bDataset[k].dcWarrantyClaims_countNotGood,aDataset[i].dcVasCompliance.countNotGood=bDataset[k].dcVasCompliance_countNotGood,aDataset[i].dcKeyAccountsChargebacks.countNotGood=bDataset[k].dcKeyAccountsChargebacks_countNotGood,aDataset[i].majorDefectsOqlRate.countRisk=bDataset[k].majorDefectsOqlRate_countRisk,aDataset[i].packagingOqlRate.countRisk=bDataset[k].packagingOqlRate_countRisk,aDataset[i].fitOqlRate.countRisk=bDataset[k].fitOqlRate_countRisk,aDataset[i].dcMajorDefectsOqlRate.countRisk=bDataset[k].dcMajorDefectsOqlRate_countRisk,aDataset[i].dcPackagingOqlRate.countRisk=bDataset[k].dcPackagingOqlRate_countRisk,aDataset[i].dcFitOqlRate.countRisk=bDataset[k].dcFitOqlRate_countRisk,aDataset[i].majorDefectsSqlRate.countRisk=bDataset[k].majorDefectsSqlRate_countRisk,aDataset[i].firstPassRate.countRisk=bDataset[k].firstPassRate_countRisk,aDataset[i].processAuditScore.countRisk=bDataset[k].processAuditScore_countRisk,aDataset[i].dcCustomizationRate.countRisk=bDataset[k].dcCustomizationRate_countRisk,aDataset[i].dcClaimsRate.countRisk=bDataset[k].dcClaimsRate_countRisk,aDataset[i].dcReworkTotal.countRisk=bDataset[k].dcReworkTotal_countRisk,aDataset[i].dcInternalChargebacks.countRisk=bDataset[k].dcInternalChargebacks_countRisk,aDataset[i].dcWarrantyClaims.countRisk=bDataset[k].dcWarrantyClaims_countRisk,aDataset[i].dcVasCompliance.countRisk=bDataset[k].dcVasCompliance_countRisk,aDataset[i].dcKeyAccountsChargebacks.countRisk=bDataset[k].dcKeyAccountsChargebacks_countRisk,delete aDataset[i].key);$scope.dataset=aDataset,console.log($scope.dataset)},setSupplyChainOrder=function(d){for(var i=0;i<d.length;i++){var coalition=d[i].coalition,supplyChain=d[i].supplychain;switch(coalition){case"Jeanswear":switch(d[i].coalitionOrder=1,supplyChain){case"VFA":d[i].supplyChainOrder=1;break;case"WJ":d[i].supplyChainOrder=2;break;case"Int Mfg-America":d[i].supplyChainOrder=3;break;case"Int Mfg-EU":d[i].supplyChainOrder=4;break;case"EU-Sourced":d[i].supplyChainOrder=5}break;case"Imagewear":switch(d[i].coalitionOrder=2,supplyChain){case"VFA":d[i].supplyChainOrder=1;break;case"VFSLA":d[i].supplyChainOrder=2;break;case"Domestic Contract":d[i].supplyChainOrder=3;break;case"Int Mfg-America":d[i].supplyChainOrder=4}break;case"Outdoor":switch(d[i].coalitionOrder=3,supplyChain){case"VFA":d[i].supplyChainOrder=1;break;case"VFSLA":d[i].supplyChainOrder=2;break;case"Int Mfg-America":d[i].supplyChainOrder=3;break;case"EU":d[i].supplyChainOrder=4}break;case"Footwear":switch(d[i].coalitionOrder=4,supplyChain){case"VFA":d[i].supplyChainOrder=1;break;case"Int Mfg-DR":d[i].supplyChainOrder=2;break;case"Sourced-DR":d[i].supplyChainOrder=3}break;case"Sportswear":switch(d[i].coalitionOrder=5,supplyChain){case"VFA":d[i].supplyChainOrder=1;break;case"VFSLA":d[i].supplyChainOrder=2;break;case"EU":d[i].supplyChainOrder=3}break;case"Contemporary":switch(d[i].coalitionOrder=6,supplyChain){case"Int Mfg-US Domestic":d[i].supplyChainOrder=1;break;case"Sourced":d[i].supplyChainOrder=2}}}};combineData(datasets[0].data,datasets[1].data),setSupplyChainOrder($scope.dataset)})},$http.post("/report",$scope.selected).success(function(res){console.log("OK")}),$scope.headers={a:["Major Visual Defects (FTY-OQL) %","Labl & Pkg Defects (FTY-OQL) %","FIT (FTY-OQL) %","Major Visual Defects (DC) %","Labl & Pkg Defects (DC) %","FIT (DC) %","Customization (DC) %"],b:["Major Visual Defects (FTY-SQL) %","First Pass @ Plant (FTY) %","Process Audits (FTY) %"],c:["Rework, Direct Cost Claims @ DC($)","Internal Chargebacks (DC) ($)"],d:["Addn Labl & Pkg (VAS) Compliance (DC)","Warranty Claims (DC) ($)","Claims (as % of Volume) (DC) %","Chargebacks ($) - Key Accounts (DC)"]},$scope.getHeader=function(header){switch(header){case"a":return"Product Quality";case"b":return"IPC";case"c":return"Financial Impact";case"d":return"Customer Satisfaction"}},$scope.format={percentage:function(data){return"NA"===data?"":(100*data).toFixed(2)+"%"},currency:function(data){var numberWithCommas=function(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};return"NA"===data?"":"$"+numberWithCommas(Math.round(data))},setColor:function(metricValue,countNotGood,countRisk,riskThreshold,goodThreshold,flip){return flip?"N/A"===metricValue?"na":riskThreshold>=metricValue?"btn-danger":metricValue>=goodThreshold?countNotGood>0?"btn-success withRisk":"btn-success":countRisk>0?"btn-warning withRisk":"btn-warning":"N/A"===metricValue?"na":metricValue>riskThreshold?"btn-danger":goodThreshold>metricValue?countNotGood>0?"btn-success withRisk":"btn-success":countRisk>0?"btn-warning withRisk":"btn-warning"},getIndicator:{majorDefectsOqlRate:function(data){var coalition=data.coalition,metricValue=data.majorDefectsOqlRate.value,countNotGood=data.majorDefectsOqlRate.countNotGood,countRisk=data.majorDefectsOqlRate.countRisk,riskThreshold=0,goodThreshold=0;switch(coalition){case"Jeanswear":goodThreshold=.04,riskThreshold=.06;break;case"Imagewear":goodThreshold=.03,riskThreshold=.05;break;case"Outdoor":goodThreshold=.02,riskThreshold=.03;break;case"Footwear":goodThreshold=.02,riskThreshold=.03;break;case"Sportswear":goodThreshold=.03,riskThreshold=.06;break;case"Contemporary":goodThreshold=.03,riskThreshold=.06;break;default:return}var color=$scope.format.setColor(metricValue,countNotGood,countRisk,riskThreshold,goodThreshold,!1);return color},packagingOqlRate:function(data){var metricValue=(data.coalition,data.packagingOqlRate.value),countNotGood=data.packagingOqlRate.countNotGood,countRisk=data.packagingOqlRate.countRisk,goodThreshold=.005,riskThreshold=.01,color=$scope.format.setColor(metricValue,countNotGood,countRisk,riskThreshold,goodThreshold,!1);return color},fitOqlRate:function(data){var coalition=data.coalition,metricValue=data.fitOqlRate.value,countNotGood=data.fitOqlRate.countNotGood,countRisk=data.fitOqlRate.countRisk,goodThreshold=.01,riskThreshold=.02;switch(coalition){case"Jeanswear":goodThreshold=.02,riskThreshold=.03;break;case"JeanswearEU":goodThreshold=.05,riskThreshold=.07;break;default:goodThreshold=.01,riskThreshold=.02}var color=$scope.format.setColor(metricValue,countNotGood,countRisk,riskThreshold,goodThreshold,!1);return color},dcMajorDefectsOqlRate:function(data){var coalition=data.coalition,metricValue=data.dcMajorDefectsOqlRate.value,countNotGood=data.dcMajorDefectsOqlRate.countNotGood,countRisk=data.dcMajorDefectsOqlRate.countRisk,riskThreshold=0,goodThreshold=0;switch(coalition){case"Jeanswear":goodThreshold=.04,riskThreshold=.06;break;case"Imagewear":goodThreshold=.03,riskThreshold=.05;break;case"Outdoor":goodThreshold=.02,riskThreshold=.03;break;case"Footwear":goodThreshold=.02,riskThreshold=.03;break;case"Sportswear":goodThreshold=.03,riskThreshold=.06;break;case"Contemporary":goodThreshold=.03,riskThreshold=.06;break;default:return}var color=$scope.format.setColor(metricValue,countNotGood,countRisk,riskThreshold,goodThreshold,!1);return color},dcPackagingOqlRate:function(data){var metricValue=(data.coalition,data.dcPackagingOqlRate.value),countNotGood=data.dcPackagingOqlRate.countNotGood,countRisk=data.dcPackagingOqlRate.countRisk,goodThreshold=.005,riskThreshold=.01,color=$scope.format.setColor(metricValue,countNotGood,countRisk,riskThreshold,goodThreshold,!1);return color},dcFitOqlRate:function(data){var coalition=data.coalition,metricValue=data.dcFitOqlRate.value,countNotGood=data.dcFitOqlRate.countNotGood,countRisk=data.dcFitOqlRate.countRisk,riskThreshold=0,goodThreshold=0;switch(coalition){case"Jeanswear":goodThreshold=.02,riskThreshold=.03;break;case"JeanswearEU":goodThreshold=.05,riskThreshold=.07;break;default:goodThreshold=.01,riskThreshold=.02}var color=$scope.format.setColor(metricValue,countNotGood,countRisk,riskThreshold,goodThreshold,!1);return color},dcCustomizationRate:function(data){var metricValue=(data.coalition,data.dcCustomizationRate.value),countNotGood=data.dcCustomizationRate.countNotGood,countRisk=data.dcCustomizationRate.countRisk,goodThreshold=.005,riskThreshold=.01,color=$scope.format.setColor(metricValue,countNotGood,countRisk,riskThreshold,goodThreshold,!1);return color},majorDefectsSqlRate:function(data){var coalition=data.coalition,metricValue=data.majorDefectsSqlRate.value,countNotGood=data.majorDefectsSqlRate.countNotGood,countRisk=data.majorDefectsSqlRate.countRisk,riskThreshold=0,goodThreshold=0;switch(coalition){case"Jeanswear":goodThreshold=.04,riskThreshold=.06;break;case"Imagewear":goodThreshold=.03,riskThreshold=.05;break;case"Outdoor":goodThreshold=.02,riskThreshold=.03;break;case"Footwear":goodThreshold=.02,riskThreshold=.03;break;case"Sportswear":goodThreshold=.03,riskThreshold=.06;break;case"Contemporary":goodThreshold=.03,riskThreshold=.06;break;default:return}var color=$scope.format.setColor(metricValue,countNotGood,countRisk,riskThreshold,goodThreshold,!1);return color},firstPassRate:function(data){var metricValue=(data.coalition,data.firstPassRate.value),countNotGood=data.firstPassRate.countNotGood,countRisk=data.firstPassRate.countRisk,riskThreshold=.89,goodThreshold=.95,color=$scope.format.setColor(metricValue,countNotGood,countRisk,riskThreshold,goodThreshold,!0);return color},processAuditScore:function(data){var metricValue=(data.coalition,data.processAuditScore.value),countNotGood=data.processAuditScore.countNotGood,countRisk=data.processAuditScore.countRisk,riskThreshold=.69,goodThreshold=.85,color=$scope.format.setColor(metricValue,countNotGood,countRisk,riskThreshold,goodThreshold,!0);return color},dcVasCompliance:function(data){var metricValue=(data.coalition,data.dcVasCompliance.value),countNotGood=data.dcVasCompliance.countNotGood,countRisk=data.dcVasCompliance.countRisk,goodThreshold=1e5,riskThreshold=1e6,color=$scope.format.setColor(metricValue,countNotGood,countRisk,riskThreshold,goodThreshold,!1);return color},dcClaimsRate:function(data){var metricValue=(data.coalition,data.dcClaimsRate.value),countNotGood=data.dcClaimsRate.countNotGood,countRisk=data.dcClaimsRate.countRisk,goodThreshold=.005,riskThreshold=.01,color=$scope.format.setColor(metricValue,countNotGood,countRisk,riskThreshold,goodThreshold,!1);return color},dcReworkTotal:function(data){var metricValue=(data.coalition,data.dcReworkTotal.value),countNotGood=data.dcReworkTotal.countNotGood,countRisk=data.dcReworkTotal.countRisk,goodThreshold=1e5,riskThreshold=1e6,color=$scope.format.setColor(metricValue,countNotGood,countRisk,riskThreshold,goodThreshold,!1);return color},dcInternalChargebacks:function(data){var metricValue=(data.coalition,data.dcInternalChargebacks.value),countNotGood=data.dcInternalChargebacks.countNotGood,countRisk=data.dcInternalChargebacks.countRisk,goodThreshold=1e5,riskThreshold=1e6,color=$scope.format.setColor(metricValue,countNotGood,countRisk,riskThreshold,goodThreshold,!1);return color},dcWarrantyClaims:function(data){var metricValue=(data.coalition,data.dcWarrantyClaims.value),countNotGood=data.dcWarrantyClaims.countNotGood,countRisk=data.dcWarrantyClaims.countRisk,goodThreshold=1e5,riskThreshold=1e6,color=$scope.format.setColor(metricValue,countNotGood,countRisk,riskThreshold,goodThreshold,!1);return color},dcKeyAccountsChargebacks:function(data){var metricValue=(data.coalition,data.dcKeyAccountsChargebacks.value),countNotGood=data.dcKeyAccountsChargebacks.countNotGood,countRisk=data.dcKeyAccountsChargebacks.countRisk,goodThreshold=1e5,riskThreshold=1e6,color=$scope.format.setColor(metricValue,countNotGood,countRisk,riskThreshold,goodThreshold,!1);return color}}},$scope.getMetric={coalition:function(data){return data.coalition},supplychain:function(data){return data.supplychain},majorDefectsOqlRate:function(data){return $scope.format.percentage(data.majorDefectsOqlRate.value)},packagingOqlRate:function(data){return $scope.format.percentage(data.packagingOqlRate.value)},fitOqlRate:function(data){return $scope.format.percentage(data.fitOqlRate.value)},dcMajorDefectsOqlRate:function(data){return $scope.format.percentage(data.dcMajorDefectsOqlRate.value)},dcPackagingOqlRate:function(data){return $scope.format.percentage(data.dcPackagingOqlRate.value)},dcFitOqlRate:function(data){return $scope.format.percentage(data.dcFitOqlRate.value)},dcCustomizationRate:function(data){return $scope.format.percentage(data.dcCustomizationRate.value)},majorDefectsSqlRate:function(data){return $scope.format.percentage(data.majorDefectsSqlRate.value)},firstPassRate:function(data){return $scope.format.percentage(data.firstPassRate.value)},processAuditScore:function(data){return $scope.format.percentage(data.processAuditScore.value)},dcReworkTotal:function(data){return $scope.format.currency(data.dcReworkTotal.value)},dcInternalChargebacks:function(data){return $scope.format.currency(data.dcInternalChargebacks.value)},dcVasCompliance:function(data){return $scope.format.currency(data.dcVasCompliance.value)},dcWarrantyClaims:function(data){return $scope.format.currency(data.dcWarrantyClaims.value)},dcClaimsRate:function(data){return $scope.format.percentage(data.dcClaimsRate.value)},dcKeyAccountsChargebacks:function(data){return $scope.format.currency(data.dcKeyAccountsChargebacks.value)}},$scope.modalDrilldown=function(size,data,metric){var modalInstance=$modal.open({templateUrl:"modules/metrics/views/drill-down.view.html",controller:["$scope","$modalInstance",function($scope,$modalInstance){var selectedData={year:data.year,month:data.month,coalition:data.coalition,supplychain:data.supplychain},getMetricTitle=function(metric){switch(metric){case"majorDefectsOqlRate":return"Major Defects Rate OQL";case"packagingOqlRate":return"Labeling & Packaging Defects Rate OQL";case"fitOqlRate":return"Measurement Defects Rate OQL";case"dcMajorDefectsOqlRate":return"Major Defects Rate OQL";case"dcPackagingOqlRate":return"Labeling & Packaging Defects Rate OQL";case"dcFitOqlRate":return"Measurement Defects Rate OQL";case"majorDefectsSqlRate":return"Major Defects Rate SQL";case"dcCustomizationRate":return"Customization Defects Rate";case"firstPassRate":return"First Pass Rate";case"processAuditScore":return"Process Audit Score";case"dcReworkTotal":return"Rework (Direct Cost Claims)";case"dcInternalChargebacks":return"Internal Chargebacks";case"dcVasCompliance":return"Additional Labl & Pkg (VAS) Compliance Costs";case"dcClaimsRate":return"DC Claims Rate";case"dcWarrantyClaims":return"DC Warranty Claims";case"dcKeyAccountsChargebacks":return"Key Accounts Chargebacks"}};$scope.selectedData=selectedData,$scope.selectedMetric=metric,$scope.metricTitle=getMetricTitle(metric);var queryData=function(){$http.put("/report/drilldown",selectedData).success(function(response){var removeNA=function(dataset,metric){var d1=[];return dataset.forEach(function(d){var val="",filter=function(o,val){("N/A"!==val&&val||0===val)&&d1.push(o)};switch(metric){case"majorDefectsOqlRate":val=d.metrics.factory.majorDefectsOql.val,filter(d,val);break;case"packagingOqlRate":val=d.metrics.factory.packagingOql.val,filter(d,val);break;case"fitOqlRate":val=d.metrics.factory.fitOql.val,filter(d,val);break;case"dcMajorDefectsOqlRate":val=d.metrics.dc.majorDefectsOql.val,filter(d,val);break;case"dcPackagingOqlRate":val=d.metrics.dc.packagingOql.val,filter(d,val);break;case"dcFitOqlRate":val=d.metrics.dc.fitOql.val,filter(d,val);break;case"dcCustomizationRate":val=d.metrics.dc.customization.val,filter(d,val);break;case"majorDefectsSqlRate":val=d.metrics.factory.majorDefectsSql.val,filter(d,val);break;case"firstPassRate":val=d.metrics.factory.firstPass.val,filter(d,val);break;case"processAuditScore":val=d.metrics.factory.processAudit.score,filter(d,val);break;case"dcReworkTotal":val=d.metrics.dc.rework.internalChargebacks,filter(d,val);break;case"dcInternalChargebacks":val=d.metrics.dc.rework.internalChargebacks,filter(d,val);break;case"dcVasCompliance":val=d.metrics.dc.vasCompliance,filter(d,val);break;case"dcWarrantyClaims":val=d.metrics.dc.warrantyClaims,filter(d,val);break;case"dcKeyAccountsChargebacks":val=d.metrics.dc.keyAccountsChargebacks,filter(d,val)}}),d1};$scope.dataset=removeNA(response,metric),console.log($scope.dataset)})};queryData(),
$scope.setSort=function(selectedMetric){switch(selectedMetric){case"majorDefectsOqlRate":return"-metrics.factory.majorDefectsOql.val";case"packagingOqlRate":return"-metrics.factory.packagingOql.val";case"fitOqlRate":return"-metrics.factory.fitOql.val";case"dcMajorDefectsOqlRate":return"-metrics.dc.majorDefectsOql.val";case"dcPackagingOqlRate":return"-metrics.dc.packagingOql.val";case"dcFitOqlRate":return"-metrics.dc.fitOql.val";case"dcCustomizationRate":return"-metrics.dc.customization.val";case"majorDefectsSqlRate":return"-metrics.factory.majorDefectsSql.val";case"firstPassRate":return"metrics.factory.firstPass.val";case"processAuditScore":return"metrics.factory.processAudit.score";case"dcReworkTotal":return"-metrics.dc.rework.internalChargebacks";case"dcInternalChargebacks":return"-metrics.dc.rework.internalChargebacks";case"dcVasCompliance":return"-metrics.dc.vasCompliance";case"dcWarrantyClaims":return"-metrics.dc.warrantyClaims";case"dcKeyAccountsChargebacks":return"-metrics.dc.keyAccountsChargebacks"}},$scope.format={percentage:function(data){return"NA"===data?"":(100*data).toFixed(2)+"%"},currency:function(data){var numberWithCommas=function(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};return"NA"===data?"":"$"+numberWithCommas(Math.round(data))},setColor:function(metricValue,riskThreshold,goodThreshold,flip){return flip?isNaN(metricValue)?"na":riskThreshold>=metricValue?"btn-danger":metricValue>=goodThreshold?"btn-success":"btn-warning":isNaN(metricValue)?"na":metricValue>=riskThreshold?"btn-danger":goodThreshold>=metricValue?"btn-success":"btn-warning"},getIndicator:function(data,selectedMetric,key){var coalition="",numerator="",denominator="",metricValue="",riskThreshold=0,goodThreshold=0,color="",isLastItem=function(d,sm){var lastItemIndex=$scope.getSelectedMetric(d,sm).length-1;return key===lastItemIndex?!0:void 0};switch(selectedMetric){case"majorDefectsOqlRate":switch(coalition=data.coalition,numerator=data.metrics.factory.majorDefectsOql.defects,denominator=data.metrics.factory.majorDefectsOql.audited,metricValue=numerator/denominator,riskThreshold=0,goodThreshold=0,coalition){case"Jeanswear":goodThreshold=.04,riskThreshold=.06;break;case"Imagewear":goodThreshold=.03,riskThreshold=.05;break;case"Outdoor":goodThreshold=.02,riskThreshold=.03;break;case"Footwear":goodThreshold=.02,riskThreshold=.03;break;case"Sportswear":goodThreshold=.03,riskThreshold=.06;break;case"Contemporary":goodThreshold=.03,riskThreshold=.06;break;default:return}if(color=$scope.format.setColor(metricValue,riskThreshold,goodThreshold,!1),isLastItem(data,selectedMetric))return color;break;case"packagingOqlRate":if(coalition=data.coalition,numerator=data.metrics.factory.packagingOql.defects,denominator=data.metrics.factory.packagingOql.audited,metricValue=numerator/denominator,riskThreshold=.005,goodThreshold=.01,color=$scope.format.setColor(metricValue,riskThreshold,goodThreshold,!1),isLastItem(data,selectedMetric))return color;break;case"fitOqlRate":switch(coalition=data.coalition,numerator=data.metrics.factory.fitOql.defects,denominator=data.metrics.factory.fitOql.audited,metricValue=numerator/denominator,riskThreshold=0,goodThreshold=0,coalition){case"Jeanswear":goodThreshold=.02,riskThreshold=.03;break;case"JeanswearEU":goodThreshold=.05,riskThreshold=.07;break;default:goodThreshold=.01,riskThreshold=.02}if(color=$scope.format.setColor(metricValue,riskThreshold,goodThreshold,!1),isLastItem(data,selectedMetric))return color;break;case"dcMajorDefectsOqlRate":switch(coalition=data.coalition,numerator=data.metrics.dc.majorDefectsOql.defects,denominator=data.metrics.dc.majorDefectsOql.audited,metricValue=numerator/denominator,riskThreshold=0,goodThreshold=0,coalition){case"Jeanswear":goodThreshold=.04,riskThreshold=.06;break;case"Imagewear":goodThreshold=.03,riskThreshold=.05;break;case"Outdoor":goodThreshold=.02,riskThreshold=.03;break;case"Footwear":goodThreshold=.02,riskThreshold=.03;break;case"Sportswear":goodThreshold=.03,riskThreshold=.06;break;case"Contemporary":goodThreshold=.03,riskThreshold=.06;break;default:return}if(color=$scope.format.setColor(metricValue,riskThreshold,goodThreshold,!1),isLastItem(data,selectedMetric))return color;break;case"dcPackagingOqlRate":if(coalition=data.coalition,numerator=data.metrics.dc.packagingOql.defects,denominator=data.metrics.dc.packagingOql.audited,metricValue=numerator/denominator,riskThreshold=.005,goodThreshold=.01,color=$scope.format.setColor(metricValue,riskThreshold,goodThreshold,!1),isLastItem(data,selectedMetric))return color;break;case"dcFitOqlRate":switch(coalition=data.coalition,numerator=data.metrics.dc.fitOql.defects,denominator=data.metrics.dc.fitOql.audited,metricValue=numerator/denominator,riskThreshold=0,goodThreshold=0,coalition){case"Jeanswear":goodThreshold=.02,riskThreshold=.03;break;case"JeanswearEU":goodThreshold=.05,riskThreshold=.07;break;default:goodThreshold=.01,riskThreshold=.02}if(color=$scope.format.setColor(metricValue,riskThreshold,goodThreshold,!1),isLastItem(data,selectedMetric))return color;break;case"dcCustomizationRate":if(coalition=data.coalition,numerator=data.metrics.dc.customization.defects,denominator=data.metrics.dc.customization.audited,metricValue=numerator/denominator,goodThreshold=.005,riskThreshold=.01,color=$scope.format.setColor(metricValue,riskThreshold,goodThreshold,!1),isLastItem(data,selectedMetric))return color;break;case"majorDefectsSqlRate":switch(coalition=data.coalition,numerator=data.metrics.factory.majorDefectsSql.defects,denominator=data.metrics.factory.majorDefectsSql.audited,metricValue=numerator/denominator,goodThreshold=0,riskThreshold=0,coalition){case"Jeanswear":goodThreshold=.04,riskThreshold=.06;break;case"Imagewear":goodThreshold=.03,riskThreshold=.05;break;case"Outdoor":goodThreshold=.02,riskThreshold=.03;break;case"Footwear":goodThreshold=.02,riskThreshold=.03;break;case"Sportswear":goodThreshold=.03,riskThreshold=.06;break;case"Contemporary":goodThreshold=.03,riskThreshold=.06;break;default:return}if(color=$scope.format.setColor(metricValue,riskThreshold,goodThreshold,!1),isLastItem(data,selectedMetric))return color;break;case"firstPassRate":if(coalition=data.coalition,numerator=data.metrics.factory.firstPass.passed,denominator=data.metrics.factory.firstPass.audited,metricValue=numerator/denominator,riskThreshold=.89,goodThreshold=.95,color=$scope.format.setColor(metricValue,riskThreshold,goodThreshold,!0),isLastItem(data,selectedMetric))return color;break;case"processAuditScore":if(coalition=data.coalition,metricValue=data.metrics.factory.processAudit.score,riskThreshold=.69,goodThreshold=.85,color=$scope.format.setColor(metricValue,riskThreshold,goodThreshold,!0),isLastItem(data,selectedMetric))return color;break;case"dcClaimsRate":if(coalition=data.coalition,numerator=data.metrics.dc.claims.returned,denominator=data.metrics.dc.claims.received,metricValue=numerator/denominator,goodThreshold=.005,riskThreshold=.01,color=$scope.format.setColor(metricValue,riskThreshold,goodThreshold,!1),isLastItem(data,selectedMetric))return color;break;default:return}}},$scope.getSelectedMetric=function(data,selectedMetric){var computedVal=0,numerator=0,denominator=0,total=0,vendorChargeback=0,score=0,date=0,dataset=[];switch(selectedMetric){case"majorDefectsOqlRate":return numerator=data.metrics.factory.majorDefectsOql.defects,denominator=data.metrics.factory.majorDefectsOql.audited,computedVal=$scope.format.percentage(numerator/denominator),dataset.push(denominator,numerator,computedVal),dataset;case"packagingOqlRate":return numerator=data.metrics.factory.packagingOql.defects,denominator=data.metrics.factory.packagingOql.audited,computedVal=$scope.format.percentage(numerator/denominator),dataset.push(denominator,numerator,computedVal),dataset;case"fitOqlRate":return numerator=data.metrics.factory.fitOql.defects,denominator=data.metrics.factory.fitOql.audited,computedVal=$scope.format.percentage(numerator/denominator),dataset.push(denominator,numerator,computedVal),dataset;case"dcMajorDefectsOqlRate":return numerator=data.metrics.dc.majorDefectsOql.defects,denominator=data.metrics.dc.majorDefectsOql.audited,computedVal=$scope.format.percentage(numerator/denominator),dataset.push(denominator,numerator,computedVal),dataset;case"dcPackagingOqlRate":return numerator=data.metrics.dc.packagingOql.defects,denominator=data.metrics.dc.packagingOql.audited,computedVal=$scope.format.percentage(numerator/denominator),dataset.push(denominator,numerator,computedVal),dataset;case"dcFitOqlRate":return numerator=data.metrics.dc.fitOql.defects,denominator=data.metrics.dc.fitOql.audited,computedVal=$scope.format.percentage(numerator/denominator),dataset.push(denominator,numerator,computedVal),dataset;case"dcCustomizationRate":return numerator=data.metrics.dc.customization.defects,denominator=data.metrics.dc.customization.audited,computedVal=$scope.format.percentage(numerator/denominator),dataset.push(denominator,numerator,computedVal),dataset;case"majorDefectsSqlRate":return numerator=data.metrics.factory.majorDefectsSql.defects,denominator=data.metrics.factory.majorDefectsSql.audited,computedVal=$scope.format.percentage(numerator/denominator),dataset.push(denominator,numerator,computedVal),dataset;case"firstPassRate":return numerator=data.metrics.factory.firstPass.passed,denominator=data.metrics.factory.firstPass.audited,computedVal=$scope.format.percentage(numerator/denominator),dataset.push(denominator,numerator,computedVal),dataset;case"processAuditScore":return score=$scope.format.percentage(data.metrics.factory.processAudit.score),date=data.metrics.factory.processAudit.date,dataset.push(date,score),dataset;case"dcReworkTotal":return total=data.metrics.dc.rework.total,vendorChargeback=data.metrics.dc.rework.vendorChargeback,computedVal=$scope.format.currency(total-vendorChargeback),dataset.push(total,vendorChargeback,computedVal),dataset;case"dcInternalChargebacks":return total=data.metrics.dc.rework.total,vendorChargeback=data.metrics.dc.rework.vendorChargeback,computedVal=$scope.format.currency(total-vendorChargeback),dataset.push(total,vendorChargeback,computedVal),dataset;case"dcVasCompliance":return dataset.push($scope.format.currency(data.metrics.dc.vasCompliance)),dataset;case"dcWarrantyClaims":return dataset.push($scope.format.currency(data.metrics.dc.warrantyClaims)),dataset;case"dcClaimsRate":return numerator=data.metrics.dc.claims.returned,denominator=data.metrics.dc.claims.received,computedVal=$scope.format.percentage(numerator/denominator),dataset.push(denominator,numerator,computedVal),dataset;case"dcKeyAccountsChargebacks":return dataset.push($scope.format.currency(data.metrics.dc.keyAccountsChargebacks)),dataset;default:return}},$scope.getHeader=function(selectedMetric){var headers=[];switch(selectedMetric){case"processAuditScore":return headers.push("Date","Score"),headers;case"dcReworkTotal":return headers.push("Total","Vendor Chargebacks","Internal Chargebacks"),headers;case"dcInternalChargebacks":return headers.push("Total","Vendor Chargebacks","Internal Chargebacks"),headers;case"dcVasCompliance":return headers.push("Total"),headers;case"dcWarrantyClaims":return headers.push("Total"),headers;case"dcClaimsRate":return headers.push("Received","Returned",getMetricTitle(selectedMetric)),headers;case"dcKeyAccountsChargebacks":return headers.push("Total"),headers;default:return headers.push("Audited","Defects Found",getMetricTitle(selectedMetric)),headers}},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}],size:size});modalInstance.result.then(function(){},function(){$log.info("Modal dismissed at: "+new Date)})}}]),metricsApp.directive("reportCard",function(){return{restrict:"EA",scope:{dataset:"=",selected:"=",getMetric:"=",format:"=",modalDrilldown:"=",coalition:"@"},transclude:!0,templateUrl:"modules/metrics/views/report-card-template.html"}}),angular.module("customFilter",[]).filter("unique",function(){return function(input,key){for(var unique={},uniqueList=[],i=0;i<input.length;i++)"undefined"==typeof unique[input[i][key]]&&(unique[input[i][key]]="",uniqueList.push(input[i]));return uniqueList}}),angular.module("metrics").factory("Metrics",["$resource",function($resource){return $resource("metrics/:metricId",{metricId:"@_id"},{update:{method:"PUT"}})}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("reset-invalid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function($scope,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.signup=function(){$http.post("/auth/signup",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})},$scope.signin=function(){$http.post("/auth/signin",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/metrics")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function($scope,$stateParams,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){$scope.success=$scope.error=null,$http.post("/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){$scope.success=$scope.error=null,$http.post("/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.hasConnectedAdditionalSocialAccounts=function(provider){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http["delete"]("/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})},$scope.updateUserProfile=function(isValid){if(isValid){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}else $scope.submitted=!0},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/users/password",$scope.passwordDetails).success(function(response){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user},_this._data}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]);